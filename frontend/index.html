<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="/logos/ouviescreviicon.png" type="image/png">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ouviescrevi â€“ Conversor Inteligente</title>
  <meta name="description" content="Converte ficheiros com IA. Word para PDF, imagens para PDF, e muito mais!">
  <meta name="keywords" content="converter Word para PDF, PDF para texto, imagem para PDF, conversor de ficheiros online, transcriÃ§Ã£o de Ã¡udio, transcriÃ§Ã£o automÃ¡tica, Ouviescrevi">

  <meta name="robots" content="index, follow">
  <style>


    body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #A550F7, #00C3FF);
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: 100% 100%;
  color: white;
  text-align: center;
}
.hourglass{
margin:0px!important;
}
	#modalTraducao {
  display: none !important;
}
#modalTraducao.show {
  display: flex !important;
}


    header {
      padding: 20px;
    }
    header h1 {
      margin: 0;
      font-size: 2em;
    }
    main {
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    form {
      background: white;
      color: #333;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin-top: 20px;
      max-width: 600px;
      width: 100%;
      text-align: left;
    }
    input, button {
      margin: 10px 0;
      padding: 10px;
      font-size: 1em;
      width: 100%;
      cursor: pointer;
    }
    button {
      background-color: #e6d7fb;
      color: #333;
      border: 2px solid #A550F7;
      border-radius: 8px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    button:hover {
      background: linear-gradient(135deg, #A550F7, #00C3FF);
      color: white;
      border-color: transparent;
    }
    .hidden { display: none; }
    #output textarea {
      width: 100%;
      height: 200px;
      margin-top: 10px;
      padding: 10px;
      font-family: monospace;
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 10px;
    }
    .btn-group button {
      flex: 1 1 auto;
      min-width: 130px;
      max-width: 200px;
      padding: 10px;
      font-size: 0.95em;
      cursor: pointer;
      border-radius: 5px;
      border: 1px solid #ccc;
      background: #f5f5f5;
      transition: background 0.3s;
    }
    .btn-group button:hover {
      background: #e0e0e0;
    }
    #resumoBox {
      margin-top: 20px;
      padding: 20px;
      background: #ffffff;
      border: 1px solid #ccc;
      border-left: 5px solid #4caf50;
      max-width: 800px;
      width: 100%;
      color: #333;
    }
    .switch-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      font-size: 14px;
    }
    .switch-container input[type="checkbox"] {
      appearance: none;
      width: 40px;
      height: 20px;
      background: #ccc;
      border-radius: 20px;
      position: relative;
      cursor: pointer;
      outline: none;
      transition: background 0.3s;
    }
    .switch-container input[type="checkbox"]::before {
      content: "";
      position: absolute;
      top: 2px;
      left: 2px;
      width: 16px;
      height: 16px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }
    .switch-container input[type="checkbox"]:checked {
      background: #4caf50;
    }
    .switch-container input[type="checkbox"]:checked::before {
      transform: translateX(20px);
    }
    .switch-label {
      user-select: none;
    }
    .hourglass {
      width: 60px;
      height: 60px;
      margin: 20px auto;
      border: 4px solid #A550F7;
      border-radius: 50%;
      position: relative;
      animation: rotateHourglass 2.5s infinite linear;
    }
    .hourglass::before, .hourglass::after {
      content: '';
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 12px;
      background: #A550F7;
      border-radius: 50%;
    }
    .hourglass::before {
      top: 12px;
      animation: sandTop 2.5s infinite linear;
    }
    .hourglass::after {
      bottom: 12px;
      animation: sandBottom 2.5s infinite linear;
    }
    @keyframes rotateHourglass {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes sandTop {
      0%   { opacity: 1; }
      50%  { opacity: 0; }
      100% { opacity: 1; }
    }
    @keyframes sandBottom {
      0%   { opacity: 0; }
      50%  { opacity: 1; }
      100% { opacity: 0; }
    }
	.btn-group button {
  flex: 1 1 auto;
  min-width: 130px;
  max-width: 200px;
  padding: 12px 18px;
  font-size: 1em;
  font-weight: bold;
  border: 2px solid #A550F7;
  border-radius: 8px;
  background-color: #e6d7fb;
  color: #333;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: color 0.3s ease, border-color 0.3s ease;
}

.btn-group button::before {
  content: "";
  position: absolute;
  left: 0;
  bottom: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #A550F7, #00C3FF);
  transition: all 0.4s ease;
  z-index: 0;
}

.btn-group button:hover::before {
  bottom: 0;
}

.btn-group button:hover {
  color: white;
  border-color: transparent;
}

.btn-group button span {
  position: relative;
  z-index: 2;
}
#adminContent{
place-items: center;
}
#modalTraducao button:hover {
  background: linear-gradient(135deg, #A550F7, #00C3FF);
  color: white;
  border-color: transparent;
}
#btnRetry {
  background: #ffc107;
  color: #333;
  border: none;
  padding: 10px 20px;
  margin-top: 15px;
  border-radius: 6px;
  font-weight: bold;
  font-size: 1em;
  cursor: pointer;
  transition: all 0.3s ease;
}
#btnRetry:hover {
  background: #ff9800;
  color: white;
}
@media (max-width: 820px) {
  main {
    padding: 20px;
  }

  form {
    padding: 15px 20px;
    width: 100%;
    max-width: 100%;
  }

  input, button {
    width: 100%;
    font-size: 1em;
  }

  .btn-group {
    flex-direction: column;
    align-items: stretch;
  }

  .btn-group button {
    max-width: 100%;
    min-width: unset;
    font-size: 1em;
  }

  #transcriptionText {
    height: 160px;
  }

  #resumoBox, #traducaoBox {
    padding: 15px;
    font-size: 0.95em;
  }

  #modalTraducao > div {
    width: 90%;
    max-width: 90%;
  }

  #btnRetry {
    width: 100%;
  }
}
#dropZone {
  border: 2px dashed #A550F7;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  border-radius: 10px;
  margin-bottom: 15px;
  background-color: #fafafa;
  color: #333;
  position: relative;
}
#dropZone:hover {
  background-color: #f0f0f0;
}
#dropZone input[type="file"] {
  display: none;
}
#fileName {
  display: block;
  margin-top: 10px;
  color: #555;
  font-size: 14px;
  font-style: italic;
}
.botao-salvar span {
  position: relative;
  z-index: 2;
}
#transcriptionText {
  width: 100%;
  min-height: 200px;
  padding: 15px;
  font-family: 'Segoe UI', sans-serif;
  font-size: 1rem;
  color: #333;
  background: #fdfdfd;
  border: 2px solid #A550F7;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  resize: vertical; /* permite ao utilizador ajustar a altura */
  line-height: 1.6;
  transition: border-color 0.3s, box-shadow 0.3s;
}

#transcriptionText:focus {
  outline: none;
  border-color: #00C3FF;
  box-shadow: 0 0 0 4px rgba(0,195,255,0.15);
}
#nichoMenu {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
  padding: 20px 10px 10px;
 
  position: sticky;
  top: 0;
  z-index: 999;
}

#nichoMenu button {
  position: relative;
  overflow: hidden;
  background-color: #e6d7fb;
  color: #333;
  border: 2px solid #A550F7;
  border-radius: 50px;
  padding: 10px 20px;
  font-weight: bold;
  font-size: 0.95em;
  cursor: pointer;
  transition: color 0.3s ease, border-color 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  flex: 0 0 auto;
  white-space: nowrap;
  width: max-content;
  z-index: 1; /* âœ… Isto Ã© importante */
}

#nichoMenu button::before {
  content: "";
  position: absolute;
  left: 0;
  bottom: -100%; /* fora de vista inicialmente */
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #A550F7, #00C3FF);
  transition: bottom 0.6s cubic-bezier(0.25, 1, 0.5, 1);
  z-index: 0;
}

#nichoMenu button:hover::before {
  bottom: 0; /* desliza para cima */
}


#nichoMenu button span {
  position: relative;
  z-index: 2; /* âœ… Garante que o texto aparece acima do gradiente */
}

#nichoMenu button:hover {
	
  color: white;
  border-color: white;
}
.dropdown-export {
  position: relative;
  display: inline-block;
}

#exportBtn {
  background-color: #e6d7fb;
  color: #333;
  border: 2px solid #A550F7;
  border-radius: 8px;
  padding: 15px 20px;
  font-weight: bold;
  font-size: 0.95em;
  cursor: pointer;
}

#exportBtn:hover {
  background: linear-gradient(135deg, #A550F7, #00C3FF);
  color: white;
  border-color: transparent;
}

.dropdown-content {
  display: flex;
  flex-direction: column;
  position: absolute;
  background-color: white;
  min-width: 180px;
  box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
  z-index: 1;
  border-radius: 8px;
  top: 110%;
  left: 0;
  padding: 5px 0;
}

.dropdown-content button {
  background: none;
  border: none;
  padding: 10px 20px;
  text-align: left;
  font-size: 0.95em;
  color: #333;
  cursor: pointer;
  width: 100%;
}

.dropdown-content button:hover {
  background-color: #f0f0f0;
}

.hidden {
  display: none;
}
  .btn-group button:active::before {
  bottom: 0;
}

.btn-group button:active span {
  position: relative;
  z-index: 3;
}
.btn-group button span {
  position: relative !important;
  z-index: 3 !important;
  display: inline-block;
}
@media only screen and (max-width: 430px) {
 .hourglass {
    width: 30px !important;
    height: 30px !important;
    margin: 0 !important;
    border: 4px solid #A550F7;
    border-radius: 50%;
    position: relative;
    animation: rotateHourglass 2.5s infinite linear;
    flex-shrink: 0;
  }

  .logo-area {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 10px;
    flex-wrap: nowrap;
  }

  .logo-area img {
    max-height: 30px;
    height: auto;
    width: auto;
  }

  .logo-area h1 {
    font-size: 1.1em;
    margin: 0;
  }

  #burgerBtn {
    background: none;
    border: none;
    font-size: 24px;
    color: white;
    cursor: pointer;
    padding: 0;
  }
}
  </style>
</head>
<body>

<div id="header"></div>

<main>
 

  <div id="adminContent" >

	
<p><strong>ğŸ§  Ouviescrevi</strong> Ã© o teu assistente com IA para <br> <strong>transcrever</strong> ğŸ™ï¸, <strong>traduzir</strong> ğŸŒ, <strong>resumir</strong> ğŸ“Œ e <strong>converter ficheiros</strong> ğŸ“„ <br> â€” tudo num clique. Simples, rÃ¡pido e gratuito.</p>


    <form id="uploadForm">
	
      <div id="dropZone">
  <p>ğŸ“ <strong>Arrasta o ficheiro aqui</strong> ou clica para escolher</p>
  <input type="file" id="fileInput" accept="audio/*,video/*" required>
  <span id="fileName">Nenhum ficheiro selecionado</span>
</div>

      <button type="submit">Transcrever</button>
      <button type="button" onclick="startRecording()">ğŸ¤ Gravar Ãudio</button>
	  <button type="button" onclick="limparTudo()" style="background:#ffffff; border:2px solid #A550F7; color:#A550F7; font-weight:bold; margin-bottom:10px;">ğŸ§¹ Limpar Tudo</button>

	  <button type="button" id="btnStopRecording" class="hidden" style="background:#ff4c4c; color:white; font-weight:bold; margin-bottom:10px;">ğŸ›‘ Parar GravaÃ§Ã£o</button>
<p id="timerGravacao" style="font-weight:bold; margin-top: 10px; display:none;">â±ï¸ 00:00</p>

		 <label class="switch-container">
  <input type="checkbox" id="identificarLocutores">
  <span class="slider"></span>
  <span class="switch-label">Identificar falas com nomes de locutores</span>
</label>


      <p id="recordingStatus"></p>
    </form>


    <div id="loading" class="hidden">
      <p>ğŸ”„ A processar transcriÃ§Ã£o...</p>
      <div style="background:#ddd; border-radius:8px; width:100%; height:20px;">
        <div id="progressBar" style="height:100%; width:0%; background:#4caf50; border-radius:8px;"></div>
      </div>
    </div>
<p id="transcricaoStatus" class="hidden" style="
  background: #fff3cd;
  color: #856404;
  border-left: 5px solid #ffc107;
  padding: 12px 18px;
  margin: 15px 0;
  border-radius: 5px;
  font-weight: bold;
  transition: opacity 0.5s ease;
  opacity: 1;
">
  ğŸ”„ A preparar...
</p>




    <div id="output" class="hidden">
      <h3>TranscriÃ§Ã£o:</h3>
      <textarea id="transcriptionText" readonly></textarea>
	  <div style="text-align: right; margin-top: 5px;">
		  <button onclick="copiarTranscricao()" style="
			background: #e6d7fb;
			border: 2px solid #A550F7;
			border-radius: 6px;
			padding: 5px 12px;
			font-size: 0.9em;
			cursor: pointer;
			color: #333;
			font-weight: bold;
		  ">ğŸ“‹ Copiar Tudo</button>
		</div>

	  <button id="btnRetry" onclick="tentarNovamente()"><span>ğŸ” Tentar novamente</span></button>



	<p id="traducaoStatus" class="hidden" style="
  background: #fff3cd;
  color: #856404;
  border-left: 5px solid #ffc107;
  padding: 12px 18px;
  margin: 15px 0;
  border-radius: 5px;
  font-weight: bold;
">
  ğŸŒ A traduzir... por favor aguarde
</p>
<div id="traducaoProgressWrapper" class="hidden" style="background:#ddd; border-radius:8px; width:100%; height:20px; margin-top:10px;">
  <div id="traducaoProgressBar" style="height:100%; width:0%; background:#A550F7; border-radius:8px;"></div>
</div>


<div id="resumoBox" class="hidden">
  <h3>ğŸ“Œ Resumo:</h3>
  <div id="resumoTexto" style="background:#f0f0f0; padding:15px; border-radius:8px; white-space:pre-wrap;"></div>
</div>
<div id="minutaBox" class="hidden">
  <h3>ğŸ“© Minuta da ReuniÃ£o:</h3>
  <div id="minutaTexto" style="background:#f0f0f0; color:#222; padding:15px; border-radius:8px; white-space:pre-wrap;"></div>
</div>

<div id="traducaoBox" class="hidden">
  <h3>ğŸŒ TraduÃ§Ã£o:</h3>
 <div id="traducaoTexto" style="background:#f0f0f0; color:#222; padding:15px; border-radius:8px; white-space:pre-wrap;"></div>


</div>
 <div id="classificacaoBox" class="hidden">
  <h3>ğŸ“š Tipo de ConteÃºdo:</h3>
  <div id="classificacaoTexto" style="background:#f0f0f0; color:#222; padding:10px; border-radius:8px; white-space:pre-wrap;"></div>
</div>
      <div class="btn-group">
        <div class="dropdown-export">
  <button id="exportBtn"><span>ğŸ“ Exportar â–¼</span></button>
  <div class="dropdown-content hidden" id="exportOptions">
    <button onclick="exportText('pdf')"><span>ğŸ“„ Exportar PDF</span></button>
    <button onclick="exportText('docx')"><span>ğŸ“ Exportar DOCX</span></button>
    <button onclick="exportText('txt')"><span>ğŸ“ƒ Exportar TXT</span></button>
    <button onclick="exportText('srt')"><span>ğŸï¸ Exportar SRT</span></button>
    <button onclick="exportText('json')"><span>ğŸ”¢ Exportar JSON</span></button>


  </div>
</div>

		<button id="btnGerarResumo"><span>ğŸ§  Gerar Resumo</span></button>


		<button onclick="gerarMinuta()"><span>ğŸ“© Gerar Minuta</span></button>
<button onclick="corrigirTextoIA()"><span>ğŸ“ Corrigir Texto</span></button>

		<button onclick="abrirModalTraducao()"><span>ğŸŒ Traduzir</span></button>
		<button onclick="classificarConteudo()"><span>ğŸ“š Classificar Tipo</span></button>
<button onclick="gerarEmailIA()"><span>ğŸ“§ Gerar Email</span></button>


      </div>
    </div>
  </div>
  
  <!-- Modal de traduÃ§Ã£o -->
<div id="modalTraducao" class="hidden" style="
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center;
  z-index: 9999;
">
  <div style="
    background: white; padding: 20px; border-radius: 10px;
    text-align: center; max-width: 400px; color: #333;
  ">
    <h3 style="margin-bottom: 10px;">ğŸŒ Seleciona o idioma de destino:</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
	<button onclick="traduzirTextoComIdioma(event, 'portuguÃªs')">PortuguÃªs</button>
      <button onclick="traduzirTextoComIdioma(event, 'inglÃªs')">InglÃªs</button>
      <button onclick="traduzirTextoComIdioma(event, 'espanhol')">Espanhol</button>
      <button onclick="traduzirTextoComIdioma(event, 'francÃªs')">FrancÃªs</button>
<button onclick="traduzirTextoComIdioma(event, 'alemÃ£o')">AlemÃ£o</button>
<button onclick="traduzirTextoComIdioma(event, 'italiano')">Italiano</button>

      <button onclick="fecharModalTraducao()">Cancelar</button>
    </div>
  </div>
</div>
<section id="apresentacaoSEO" style="max-width: 800px; margin: 40px auto; background: white; padding: 20px; border-radius: 12px; color: #333; font-size: 1.1em; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
  <h2 style="color: #A550F7;">ğŸ§  O que Ã© o Ouviescrevi?</h2>
  <p>
    Ouviescrevi Ã© uma ferramenta online que utiliza InteligÃªncia Artificial (IA) para <strong>transcrever Ã¡udio e vÃ­deo automaticamente</strong>, gerar <strong>resumos inteligentes</strong>, <strong>traduzir</strong> textos, <strong>corrigir erros</strong> e atÃ© <strong>converter ficheiros como Word para PDF</strong>, imagem para texto, e muito mais.
  </p>
  <p>
    Ideal para <strong>professores</strong>, <strong>jornalistas</strong>, <strong>estudantes</strong>, <strong>empresas</strong> e qualquer pessoa que precise transformar voz em texto de forma rÃ¡pida e gratuita.
  </p>
  <p>
    NÃ£o precisas instalar nada. Basta arrastar um ficheiro, gravar a tua voz ou colar o texto â€” e deixas o resto connosco. ğŸš€
  </p>
 <div style="margin-top: 15px; text-align: left; display: inline-block;">
  <p><strong>Funcionalidades principais:</strong></p>
  <div style="line-height: 1.8;">
    <p>ğŸ™ï¸ TranscriÃ§Ã£o de Ã¡udio/vÃ­deo (com Whisper AI)</p>
    <p>ğŸ§  Resumo automÃ¡tico de texto e PDFs</p>
    <p>ğŸŒ TraduÃ§Ã£o para vÃ¡rios idiomas</p>
    <p>ğŸ“š ClassificaÃ§Ã£o automÃ¡tica do tipo de conteÃºdo</p>
    <p>ğŸ“ Conversor de Word, PDF, Imagens, etc.</p>
  </div>
</div>

  <p>
    ComeÃ§a agora gratuitamente. Simples, seguro e feito em Portugal ğŸ‡µğŸ‡¹
  </p>
</section>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
 

 

  const form = document.getElementById("uploadForm");
  const loading = document.getElementById("loading");
  const progressBar = document.getElementById("progressBar");
  const output = document.getElementById("output");
  const transcriptionText = document.getElementById("transcriptionText");
  let progressInterval;
const statusFrases = [
  "ğŸ§© A montar o quebra-cabeÃ§as da tua gravaÃ§Ã£o...",
  "ğŸ§  A preparar os neurÃ³nios para ouvir o ficheiro...",
  "ğŸ“¡ A sintonizar as ondas do Ã¡udio...",
  "ğŸ§ A escutar com atenÃ§Ã£o... jÃ¡ comeÃ§Ã¡mos a transcrever!",
  "ğŸ’¬ A traduzir som em texto com alma..."
];

let statusInterval;

function iniciarFrasesAnimadas(statusElement) {
  let i = 0;
  statusElement.textContent = statusFrases[i];
  statusElement.classList.remove("hidden");
  statusElement.style.opacity = 1;

  statusInterval = setInterval(() => {
    statusElement.style.opacity = 0;
    setTimeout(() => {
      i = (i + 1) % statusFrases.length;
      statusElement.textContent = statusFrases[i];
      statusElement.style.opacity = 1;
    }, 400);
  }, 2800);
}

function pararFrasesAnimadas(statusElement) {
  clearInterval(statusInterval);
  statusElement.style.opacity = 1;
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const file = document.getElementById("fileInput").files[0];
  if (!file) return;

  const formData = new FormData();
  formData.append("file", file);

  const status = document.getElementById("transcricaoStatus");
  const progressBar = document.getElementById("progressBar");

  // âŒ Desativar botÃµes durante a transcriÃ§Ã£o
  const btnTranscrever = form.querySelector('button[type="submit"]');
  const btnGravar = form.querySelector('button[onclick="startRecording()"]');
  btnTranscrever.disabled = true;
  btnGravar.disabled = true;
  btnTranscrever.style.opacity = 0.5;
  btnGravar.style.opacity = 0.5;

  // Reset UI
  document.getElementById("output").classList.add("hidden");
  document.getElementById("transcriptionText").value = "";
  document.getElementById("loading").classList.remove("hidden");
  status.classList.remove("hidden");
  progressBar.style.width = "0%";

  iniciarFrasesAnimadas(status);

  let progress = 0;
  let interval = setInterval(() => {
    if (progress < 90) {
      progress += Math.random() * 5;
      progressBar.style.width = `${progress.toFixed(1)}%`;
    }
  }, 200);

  let tentativa = 1;
  let sucesso = false;
  let data = {};

  while (tentativa <= 2 && !sucesso) {
    try {
      if (tentativa === 2) {
        pararFrasesAnimadas(status);
        status.textContent = "ğŸ˜“ EstÃ¡ difÃ­cil... mas estamos a tentar novamente com toda a forÃ§a!";
      }

      const res = await fetch("https://api.ouviescrevi.pt/transcribe", {
        method: "POST",
        body: formData
      });

      data = await res.json();
      sucesso = true;
    } catch (err) {
      tentativa++;
      if (tentativa > 2) {
        console.error("âŒ Falha total:", err);
      }
    }
  }

  clearInterval(interval);
  progressBar.style.width = "100%";
  pararFrasesAnimadas(status);

  if (sucesso && (data.formatted || data.transcription)) {
    const identificar = document.getElementById("identificarLocutores").checked;
    let textoFinal = data.formatted || data.transcription;
    if (identificar) textoFinal = aplicarLocutores(textoFinal);

    document.getElementById("transcriptionText").value = textoFinal;
    document.getElementById("output").classList.remove("hidden");
    status.textContent = "âœ… TranscriÃ§Ã£o concluÃ­da com sucesso!";
  } else {
    document.getElementById("transcriptionText").value = "âŒ Erro ao transcrever. Tenta novamente mais tarde.";
    document.getElementById("output").classList.remove("hidden");
    status.textContent = "âš ï¸ NÃ£o conseguimos transcrever desta vez.";
  }

  setTimeout(() => {
    document.getElementById("loading").classList.add("hidden");
    status.classList.add("hidden");
    progressBar.style.width = "0%";

    if (!sucesso) {
      ultimaTentativaFalhada = true;
      document.getElementById("btnRetry").classList.remove("hidden");
    } else {
      ultimaTentativaFalhada = false;
      document.getElementById("btnRetry").classList.add("hidden");
    }

    // âœ… Reativar botÃµes apÃ³s a transcriÃ§Ã£o
    btnTranscrever.disabled = false;
    btnGravar.disabled = false;
    btnTranscrever.style.opacity = 1;
    btnGravar.style.opacity = 1;

  }, 1200);
});





  function exportText(type) {
    const text = transcriptionText.value;

    if (type === 'pdf') {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const textLines = doc.splitTextToSize(text, 180);
      let y = 20;
      for (let i = 0; i < textLines.length; i++) {
        if (y > 270) {
          doc.addPage();
          y = 20;
        }
        doc.text(textLines[i], 15, y);
        y += 8;
      }
      doc.save("transcricao.pdf");
    }
    else if (type === 'docx') {
      const blob = new Blob([text], { type: 'application/msword;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "transcricao.doc";
      a.click();
      URL.revokeObjectURL(url);
    }
    else if (type === 'txt') {
      const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "transcricao.txt";
      a.click();
      URL.revokeObjectURL(url);
    }
    else if (type === 'json') {
      const json = JSON.stringify({ transcription: text }, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "transcricao.json";
      a.click();
      URL.revokeObjectURL(url);
    }
    else if (type === 'srt') {
      const lines = text.split('\n');
      let srt = '', count = 1;
      for (let line of lines) {
        const match = line.match(/^\[(\d{2}):(\d{2})\] (.+)$/);
        if (match) {
          const [_, min, sec, content] = match;
          const start = `00:${min}:${sec},000`;
          const end = `00:${min}:${String(parseInt(sec) + 2).padStart(2, '0')},000`;
          srt += `${count}\n${start} --> ${end}\n${content}\n\n`;
          count++;
        }
      }
      const blob = new Blob([srt], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "transcricao.srt";
      a.click();
      URL.revokeObjectURL(url);
    }
  }

  let mediaRecorder;
  let audioChunks = [];

 let timerInterval;

async function startRecording() {
  const status = document.getElementById("recordingStatus");
  const startBtn = document.querySelector("button[onclick='startRecording()']");
  const stopBtn = document.getElementById("btnStopRecording");
  const transcribeBtn = document.querySelector("#uploadForm button[type='submit']");
  const timer = document.getElementById("timerGravacao");

  if (mediaRecorder && mediaRecorder.state === "recording") return;

  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];

  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

  mediaRecorder.onstop = async () => {
    clearInterval(timerInterval);
    timer.style.display = "none";
    timer.textContent = "â±ï¸ 00:00";

    stopBtn.classList.add("hidden");
    startBtn.disabled = false;
    transcribeBtn.disabled = false;

    startBtn.style.opacity = 1;
    transcribeBtn.style.opacity = 1;

    const blob = new Blob(audioChunks, { type: 'audio/webm' });
    const formData = new FormData();
    formData.append("file", blob, "gravacao.webm");

    status.textContent = "ğŸ• A processar o Ã¡udio...";
    document.getElementById("loading").classList.remove("hidden");

    try {
      const res = await fetch("https://api.ouviescrevi.pt/transcribe", {
        method: "POST",
        body: formData
      });
      const data = await res.json();

      document.getElementById("transcriptionText").value = data.formatted || data.transcription || "âš ï¸ Erro ao transcrever.";
      document.getElementById("output").classList.remove("hidden");
      status.textContent = "âœ… TranscriÃ§Ã£o concluÃ­da!";
    } catch (err) {
      status.textContent = "âŒ Erro ao processar Ã¡udio.";
    }

    document.getElementById("loading").classList.add("hidden");
  };

  // Mostrar timer e iniciar contagem
  timer.style.display = "block";
  let segundos = 0;
  timerInterval = setInterval(() => {
    segundos++;
    const min = String(Math.floor(segundos / 60)).padStart(2, '0');
    const sec = String(segundos % 60).padStart(2, '0');
    timer.textContent = `â±ï¸ ${min}:${sec}`;
  }, 1000);

  mediaRecorder.start();
  status.textContent = "ğŸ™ï¸ A gravar... clique em 'Parar GravaÃ§Ã£o' para terminar.";
  stopBtn.classList.remove("hidden");
  startBtn.disabled = true;
  transcribeBtn.disabled = true;

  startBtn.style.opacity = 0.5;
  transcribeBtn.style.opacity = 0.5;
}
document.getElementById("btnStopRecording").addEventListener("click", () => {
  if (mediaRecorder && mediaRecorder.state === "recording") {
    mediaRecorder.stop();
  }
});


 
 async function gerarResumo(event) {
    const text = transcriptionText.value.trim();
    if (!text) {
        alert("âš ï¸ TranscriÃ§Ã£o vazia.");
        return;
    }

    const btn = event?.target?.closest("button") || document.querySelector("#btnGerarResumo");
    const span = btn.querySelector("span");
    const originalText = span ? span.textContent : btn.textContent;

    if (span) span.textContent = "ğŸ§  A gerar resumo...";
    else btn.textContent = "ğŸ§  A gerar resumo...";

    btn.disabled = true;

    const resumoTexto = document.getElementById("resumoTexto");
    const resumoBox = document.getElementById("resumoBox");

    try {
        const res = await fetch("https://api.ouviescrevi.pt/summarize", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                text: text,
                token: "ouviescrevi2025@resumo"
            })
        });

        const data = await res.json();

        if (data.summary) {
            resumoTexto.textContent = data.summary;
        } else if (data.error) {
            resumoTexto.textContent = "âŒ Erro ao gerar resumo: " + data.error;
        } else {
            resumoTexto.textContent = "âŒ Erro inesperado na resposta.";
        }

        resumoBox.classList.remove("hidden");
    } catch (err) {
        alert("âŒ Erro ao gerar resumo.");
        console.error(err);
    } finally {
        if (span) span.textContent = originalText;
        else btn.textContent = originalText;
        btn.disabled = false;
    }
}

function aplicarLocutores(transcricao) {
  const linhas = transcricao.split('\n');
  let resultado = '';
  let locutorAtual = 'JoÃ£o';

  for (let i = 0; i < linhas.length; i++) {
    const linha = linhas[i].trim();
    if (!linha) continue;

    const novaLinha = linha.replace(/^\[(\d{2}:\d{2})\]/, (match, timestamp) => {
      const nome = locutorAtual;
      locutorAtual = locutorAtual === 'JoÃ£o' ? 'Maria' : 'JoÃ£o'; // alternar
      return `[${timestamp}] ${nome}:`;
    });

    resultado += novaLinha + '\n';
  }

  return resultado.trim();
}
// Torna o campo editÃ¡vel (jÃ¡ estÃ¡ assim por padrÃ£o)
transcriptionText.removeAttribute("readonly");

// Cria aviso informativo acima do textarea
const avisoEditar = document.createElement("div");
avisoEditar.innerHTML = `<div style="background: #fff3cd; color: #856404; border-left: 5px solid #ffc107; padding: 12px 18px; margin-bottom: 15px; font-size: 15px; border-radius: 5px;">
  âœï¸ <strong>Podes editar o texto abaixo</strong>. Quando terminares, clica em <strong>"Salvar AlteraÃ§Ãµes"</strong> para guardar.
</div>
`;
avisoEditar.style.background = "#fff8dc";
avisoEditar.style.borderLeft = "5px solid #ffc107";
avisoEditar.style.padding = "10px 15px";
avisoEditar.style.marginBottom = "10px";
avisoEditar.style.fontSize = "14px";

// Cria botÃ£o de salvar
const btnSalvar = document.createElement("button");
btnSalvar.innerHTML = '<span>ğŸ’¾ Salvar AlteraÃ§Ãµes</span>';

btnSalvar.style.background = "#4caf50";
btnSalvar.style.color = "#fff";
btnSalvar.style.fontWeight = "bold";
btnSalvar.style.marginBottom = "15px";
btnSalvar.style.cursor = "pointer";
btnSalvar.onclick = () => {
  const textoAtualizado = transcriptionText.value.trim();
  localStorage.setItem("transcricao_temporaria", textoAtualizado);

  btnSalvar.innerHTML = '<span>âœ… AlteraÃ§Ãµes salvas!</span>';
  btnSalvar.disabled = true;

  setTimeout(() => {
    btnSalvar.innerHTML = '<span>ğŸ’¾ Salvar AlteraÃ§Ãµes</span>';
    btnSalvar.disabled = false;
  }, 2000);
};


document.addEventListener("DOMContentLoaded", () => {

 // Oculta o modal de traduÃ§Ã£o no arranque, por garantia
  document.getElementById("modalTraducao").classList.add("hidden");
  const btnGroup = document.querySelector(".btn-group");
  transcriptionText.parentElement.insertBefore(avisoEditar, transcriptionText);
  btnGroup.insertBefore(btnSalvar, btnGroup.firstChild);

  const guardada = localStorage.getItem("transcricao_temporaria");
// Carrega automaticamente a transcriÃ§Ã£o guardada, sem mostrar aviso
if (guardada && transcriptionText.value.trim() === "") {
  transcriptionText.value = guardada;
}

 // âœ… ADICIONA AQUI
  document.getElementById("btnGerarResumo").addEventListener("click", gerarResumo);
});
function abrirModalTraducao() {
  const modal = document.getElementById("modalTraducao");
  modal.classList.add("show");
}

function fecharModalTraducao() {
  const modal = document.getElementById("modalTraducao");
  modal.classList.remove("show");
  
}


async function traduzirTextoComIdioma(event, idioma) {
  fecharModalTraducao();

  const texto = transcriptionText.value.trim();
  if (!texto) {
    alert("âš ï¸ TranscriÃ§Ã£o vazia.");
    return;
  }

  const status = document.getElementById("traducaoStatus");
  const progressBar = document.getElementById("traducaoProgressBar");
  const progressWrapper = document.getElementById("traducaoProgressWrapper");

  // Mostrar loading visual
  status.classList.remove("hidden");
  status.textContent = "ğŸŒ A traduzir... por favor aguarda";
  //progressWrapper.classList.remove("hidden");
  progressBar.style.width = "0%";

  let progress = 0;
  const interval = setInterval(() => {
    if (progress < 90) {
      progress += Math.random() * 5;
      progressBar.style.width = `${progress}%`;
    }
  }, 200);

  const btn = event.target;
  const originalText = btn.textContent || "ğŸŒ Traduzir";
  btn.textContent = "ğŸŒ A traduzir...";
  btn.disabled = true;

  try {
    const response = await fetch("https://api.ouviescrevi.pt/translate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        text: texto,
        language: idioma,
        token: "ouviescrevi2025@resumo"
      })
    });

    const data = await response.json();

    clearInterval(interval);
    progressBar.style.width = "100%";

    if (data.translation) {
      transcriptionText.value = data.translation;
      document.getElementById("traducaoTexto").textContent = data.translation;
      document.getElementById("traducaoBox").classList.remove("hidden");
      status.textContent = "âœ… TraduÃ§Ã£o concluÃ­da com sucesso!";
    } else {
      status.textContent = "âŒ Erro: TraduÃ§Ã£o nÃ£o recebida.";
    }

  } catch (err) {
    console.error(err);
    status.textContent = "âŒ Oops! Tivemos um problema ao comunicar com a IA.";
  } finally {
    setTimeout(() => {
      status.classList.add("hidden");
      progressWrapper.classList.add("hidden");
      progressBar.style.width = "0%";
    }, 1200);

    btn.textContent = originalText;
    btn.disabled = false;
  }
}




document.getElementById("modalTraducao").addEventListener("click", function(e) {
  if (e.target.id === "modalTraducao") {
    fecharModalTraducao();
  }
});



document.addEventListener("DOMContentLoaded", () => {
  const dropZone = document.getElementById("dropZone");
  const fileInput = document.getElementById("fileInput");
  const fileNameDisplay = document.getElementById("fileName");

  dropZone.addEventListener("click", () => {
    fileInput.click();
  });

  dropZone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZone.style.background = "#e0d7ff";
  });

  dropZone.addEventListener("dragleave", () => {
    dropZone.style.background = "#fafafa";
  });

  dropZone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropZone.style.background = "#fafafa";
    if (e.dataTransfer.files.length > 0) {
      fileInput.files = e.dataTransfer.files;
      fileNameDisplay.textContent = `Ficheiro: ${fileInput.files[0].name}`;
    }
  });

  fileInput.addEventListener("change", () => {
    if (fileInput.files.length > 0) {
      fileNameDisplay.textContent = `Ficheiro: ${fileInput.files[0].name}`;
    } else {
      fileNameDisplay.textContent = "Nenhum ficheiro selecionado";
    }
  });

});

document.getElementById("btnStopRecording").addEventListener("click", () => {
  if (mediaRecorder && mediaRecorder.state === "recording") {
    mediaRecorder.stop();
  }
});

function tentarNovamente() {
  const form = document.getElementById("uploadForm");

  if (!form) {
    console.error("âŒ FormulÃ¡rio nÃ£o encontrado!");
    return;
  }

  const file = document.getElementById("fileInput").files[0];
  if (!file) {
    alert("âš ï¸ Nenhum ficheiro selecionado. Por favor, seleciona um ficheiro antes de tentar novamente.");
    return;
  }

  // Submeter manualmente
  console.log("ğŸ” A tentar novamente a transcriÃ§Ã£o...");
  form.dispatchEvent(new Event("submit", { bubbles: true, cancelable: true }));
}

async function classificarConteudo() {
  const text = transcriptionText.value.trim();
  if (!text) {
    alert("âš ï¸ TranscriÃ§Ã£o vazia.");
    return;
  }

  const btn = event.target;
  const originalText = btn.textContent;
  btn.textContent = "ğŸ“š A classificar...";
  btn.disabled = true;

  const classificacaoTexto = document.getElementById("classificacaoTexto");
  const classificacaoBox = document.getElementById("classificacaoBox");

  try {
    const res = await fetch("https://api.ouviescrevi.pt/classify", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        text: text,
        token: "ouviescrevi2025@resumo"
      })
    });

    const data = await res.json();
    if (data.type) {
      classificacaoTexto.textContent = `ğŸ” ${data.type}`;
    } else if (data.error) {
      classificacaoTexto.textContent = `âŒ Erro: ${data.error}`;
    } else {
      classificacaoTexto.textContent = `âŒ Erro inesperado.`;
    }

    classificacaoBox.classList.remove("hidden");

  } catch (err) {
    console.error("âŒ Erro ao classificar:", err);
    classificacaoTexto.textContent = "âŒ Falha ao comunicar com a API.";
    classificacaoBox.classList.remove("hidden");
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
}
async function corrigirTextoIA() {
  const text = transcriptionText.value.trim();
  if (!text) {
    alert("âš ï¸ TranscriÃ§Ã£o vazia.");
    return;
  }

 const btn = event.target.closest("button");
const span = btn.querySelector("span");
const originalText = span.textContent;
span.textContent = "ğŸ“ A corrigir...";
  btn.disabled = true;

  try {
    const res = await fetch("https://api.ouviescrevi.pt/correct", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        text: text,
        token: "ouviescrevi2025@resumo"
      })
    });

    const data = await res.json();
    if (data.corrected) {
      transcriptionText.value = data.corrected;
      alert("âœ… Texto corrigido com sucesso!");
    } else if (data.error) {
      alert("âŒ Erro: " + data.error);
    } else {
      alert("âŒ Erro inesperado na correÃ§Ã£o.");
    }

  } catch (err) {
    console.error("âŒ Erro ao corrigir:", err);
    alert("âŒ Falha ao comunicar com a API.");
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
}

async function gerarMinuta() {
  const text = transcriptionText.value.trim();
  if (!text) {
    alert("âš ï¸ TranscriÃ§Ã£o vazia.");
    return;
  }

  const btn = event.target;
  const originalText = btn.textContent;
  btn.textContent = "ğŸ“© A gerar minuta...";
  btn.disabled = true;

  const minutaTexto = document.getElementById("minutaTexto");
  const minutaBox = document.getElementById("minutaBox");

  try {
    const res = await fetch("https://api.ouviescrevi.pt/summarize", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        text: text,
        mode: "minuta", // <- chave importante!
        token: "ouviescrevi2025@resumo"
      })
    });

    const data = await res.json();
    if (data.summary) {
      minutaTexto.textContent = data.summary;
      minutaBox.classList.remove("hidden");
    } else {
      minutaTexto.textContent = "âŒ Erro ao gerar minuta.";
      minutaBox.classList.remove("hidden");
    }

  } catch (err) {
    console.error("âŒ Erro ao gerar minuta:", err);
    minutaTexto.textContent = "âŒ Erro inesperado ao comunicar com a API.";
    minutaBox.classList.remove("hidden");
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
}
async function gerarEmailIA() {
  const text = transcriptionText.value.trim();
  if (!text) return alert("âš ï¸ TranscriÃ§Ã£o vazia.");

  const tone = confirm("Usar tom informal?") ? "informal" : "formal";

  const btn = event.target;
  const original = btn.textContent;
  btn.textContent = "ğŸ“§ A gerar email...";
  btn.disabled = true;

  try {
    const res = await fetch("https://api.ouviescrevi.pt/generate-email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        text: text,
        token: "ouviescrevi2025@resumo",
        tone: tone
      })
    });
    const data = await res.json();
    if (data.email) {
      alert("ğŸ“¨ Email gerado com sucesso!\n\n" + data.email);
    } else {
      alert("âŒ Erro ao gerar email: " + data.error);
    }
  } catch (err) {
    alert("âŒ Falha ao comunicar com a IA.");
  } finally {
    btn.textContent = original;
    btn.disabled = false;
  }
}

function irParaNicho(nicho) {
  window.location.href = `${nicho}.html`;
}
function irParaResumo() {
  window.location.href = "resumo.html"; // ou o nome real do ficheiro/resumo.html
}
document.getElementById("exportBtn").addEventListener("click", () => {
  const options = document.getElementById("exportOptions");
  options.classList.toggle("hidden");
});

window.addEventListener("click", (e) => {
  if (!e.target.closest(".dropdown-export")) {
    document.getElementById("exportOptions").classList.add("hidden");
  }
});
function copiarTranscricao() {
  const textarea = document.getElementById("transcriptionText");
  textarea.select();
  document.execCommand("copy");

  // Feedback visual
  const btn = event.target;
  btn.textContent = "âœ… Copiado!";
  setTimeout(() => btn.textContent = "ğŸ“‹ Copiar Tudo", 2000);
}
window.addEventListener("error", function(e) {
  console.error("Erro global:", e.message, e);
});
function limparTudo() {
  // Limpa o ficheiro
  const fileInput = document.getElementById("fileInput");
  fileInput.value = "";
  document.getElementById("fileName").textContent = "Nenhum ficheiro selecionado";

  // Limpa o texto da transcriÃ§Ã£o e oculta outputs
  document.getElementById("transcriptionText").value = "";
  document.getElementById("output").classList.add("hidden");

  // Limpa caixas extra
  document.getElementById("resumoTexto").textContent = "";
  document.getElementById("traducaoTexto").textContent = "";
  document.getElementById("minutaTexto").textContent = "";
  document.getElementById("classificacaoTexto").textContent = "";

  document.getElementById("resumoBox").classList.add("hidden");
  document.getElementById("traducaoBox").classList.add("hidden");
  document.getElementById("minutaBox").classList.add("hidden");
  document.getElementById("classificacaoBox").classList.add("hidden");

  // Oculta status e loading
  document.getElementById("transcricaoStatus").classList.add("hidden");
  document.getElementById("traducaoStatus").classList.add("hidden");
  document.getElementById("traducaoProgressWrapper").classList.add("hidden");
  document.getElementById("progressBar").style.width = "0%";
  document.getElementById("traducaoProgressBar").style.width = "0%";
  document.getElementById("loading").classList.add("hidden");

  // Oculta botÃ£o retry
  document.getElementById("btnRetry").classList.add("hidden");

  // Limpa localStorage
  localStorage.removeItem("transcricao_temporaria");

  // Reset ao checkbox de locutores
  document.getElementById("identificarLocutores").checked = false;

  // Limpa status visual
  document.getElementById("recordingStatus").textContent = "";
  document.getElementById("timerGravacao").style.display = "none";
  document.getElementById("timerGravacao").textContent = "â±ï¸ 00:00";
}

</script>


<!-- No final do <body> -->
<script>
  fetch("header.html")
    .then(response => response.text())
    .then(html => {
      const headerDiv = document.getElementById("header");
      headerDiv.innerHTML = html;

      const tempDiv = document.createElement("div");
      tempDiv.innerHTML = html;

      tempDiv.querySelectorAll("script").forEach(oldScript => {
        const newScript = document.createElement("script");
        if (oldScript.src) newScript.src = oldScript.src;
        else newScript.textContent = oldScript.textContent;
        document.body.appendChild(newScript);
      });

      tempDiv.querySelectorAll("style").forEach(style => {
        document.head.appendChild(style.cloneNode(true));
      });
    });
</script>
<div id="footer"></div>
<script>
  fetch("footer.html")
    .then(res => res.text())
    .then(html => document.getElementById("footer").innerHTML = html);
</script>
</body>
</html>
